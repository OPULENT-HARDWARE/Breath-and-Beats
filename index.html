<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Infinite Present — Pulse Dial</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Saira:wght@400;500;600&display=swap');
  :root{
    --bg:#000000;
    --ring-base:#161616;
    --progress:rgba(255,255,255,0.88);
    --text:#e8eef5;
    --muted:#8e8e8e;
  }

  html,body{
    margin:0; padding:0;
    background:var(--bg); color:var(--text);
    font-family:'Saira',ui-sans-serif,system-ui;
    /* allow scrolling in tight embeds */
    overflow:auto;
  }

  /* Layout becomes column-based so we can measure and fit */
  .wrap{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    padding:clamp(12px,2vw,28px);
    min-height:100vh; /* lets the page scroll if it's still too tight */
    box-sizing:border-box;
  }

  .card{
    width:100%;
    max-width:600px;
    /* JS will set explicit width/height px to keep controls visible */
    position:relative;
    background:#000;
    box-sizing:border-box;
  }

  svg{width:100%; height:100%; display:block;}

  .center-text{
    position:absolute; inset:0;
    display:grid; place-items:center;
    text-align:center;
  }

  .label{font-size:clamp(14px,2vw,18px);color:var(--muted);margin-top:6px;transition:opacity 0.5s;}
  .legend{position:absolute;bottom:14px;left:16px;font-size:12px;color:var(--muted);opacity:.9;}

  .controls{
    text-align:center;
    margin-top:4px;
    color:var(--muted);
  }
  .controls label{margin-right:4px;}
  input,select{
    background:#111;
    border:1px solid #333;
    color:var(--text);
    font-family:inherit;
    padding:4px 6px;
    border-radius:4px;
    margin:0 4px;
    width:80px;
    text-align:center;
  }

  .high-contrast{
    --ring-base:#10151a;
    --progress:#00ff8a;
    --muted:#ffffff;
  }

  #status{
    font-size:clamp(16px,3vw,26px);
    font-weight:500;
    transition:opacity 0.8s ease;
  }

  /* Prefer a square on roomy screens; JS still caps size when short */
  @media (min-height: 700px) {
    .card { aspect-ratio: 1 / 1; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card" aria-label="Pulsing dial representing the present moment">
      <svg viewBox="-100 -100 200 200" aria-hidden="true">
        <defs>
          <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="3" result="b"/>
            <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>

        <!-- Base circle -->
        <circle cx="0" cy="0" r="74" fill="none" stroke="var(--ring-base)" stroke-width="8" />

        <!-- Pulsing ring -->
        <circle id="pulse" cx="0" cy="0" r="74" fill="none" stroke="var(--progress)" stroke-width="4" filter="url(#glow)" />
      </svg>

      <div class="center-text">
        <div>
          <div id="status">∞</div>
          <div class="label" id="modeLabel">—</div>
        </div>
      </div>

      <div class="legend">press <kbd>H</kbd> for high-contrast • <kbd>R</kbd> for rest</div>
    </div>

    <div class="controls">
      <label for="bpm">BPM:</label>
      <input id="bpm" type="number" min="20" max="200" value="60" />
      <select id="mode">
        <option value="breath">Breath</option>
        <option value="heartbeat">Heartbeat</option>
      </select>
    </div>
  </div>

<script>
/* --- Animation & interactions --- */
(function(){
  const card=document.getElementById('card');
  const pulse=document.getElementById('pulse');
  const status=document.getElementById('status');
  const modeLabel=document.getElementById('modeLabel');
  const bpmInput=document.getElementById('bpm');
  const modeSelect=document.getElementById('mode');

  let bpm=60;
  let mode='breath';
  let start=performance.now();
  let resting=false;

  bpmInput.addEventListener('input',()=>bpm=Math.min(200,Math.max(20,parseFloat(bpmInput.value)||60)));
  modeSelect.addEventListener('change',()=>mode=modeSelect.value);

  document.addEventListener('keydown',e=>{
    const k=e.key.toLowerCase();
    if(k==='h') document.body.classList.toggle('high-contrast');
    if(k==='r'){ resting=!resting; if(resting){ enterRest(); } else { exitRest(); } }
  });

  function enterRest(){
    resting=true;
    pulse.setAttribute('transform','scale(1)');
    pulse.setAttribute('stroke-opacity','0.3');
    modeLabel.textContent='stillness';
    status.style.opacity=0; // fade out BPM
  }

  function exitRest(){
    resting=false;
    status.style.opacity=1;
  }

  function animate(t){
    if(!resting){
      const elapsed=(t-start)/1000;
      const beatDuration=60/bpm;
      const phase=(elapsed%beatDuration)/beatDuration; // 0→1

      let intensity;
      if(mode==='breath'){
        intensity=(Math.sin(phase*Math.PI*2-Math.PI/2)+1)/2;
        modeLabel.textContent='breathing';
      }else{
        intensity=Math.pow(Math.sin(phase*Math.PI),6);
        modeLabel.textContent='heartbeat';
      }

      const scale=1+intensity*0.1;
      const opacity=0.3+intensity*0.7;

      pulse.setAttribute('transform',`scale(${scale.toFixed(3)})`);
      pulse.setAttribute('stroke-opacity',opacity.toFixed(3));
      status.textContent=`${bpm.toFixed(0)} BPM`;
    }
    requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
})();

/* --- Resizer: keeps controls visible in short landscape iframes (e.g., Xeneon Edge) --- */
(function(){
  const wrap = document.querySelector('.wrap');
  const card = document.getElementById('card');
  const controls = document.querySelector('.controls');

  function fitCard(){
    // Total vertical space available to the wrap (iframe height in embeds)
    const wrapH = wrap.clientHeight;
    const controlsH = controls.offsetHeight;
    const verticalGaps = 24; // approx padding/gap
    const availableH = Math.max(120, wrapH - controlsH - verticalGaps);

    // Horizontal space (respecting max-width on card)
    const wrapW = wrap.clientWidth;
    const maxW = Math.min(600, wrapW);

    // Choose the largest square that fits both width and available height
    const size = Math.floor(Math.max(120, Math.min(maxW, availableH)));

    // Apply explicit pixel size so the SVG fills it
    card.style.width  = size + 'px';
    card.style.height = size + 'px';
  }

  // Run on load and on any resize/orientation changes
  window.addEventListener('load', fitCard);
  window.addEventListener('resize', fitCard);
  window.addEventListener('orientationchange', fitCard);

  // Observe size changes (some containers resize without window events)
  const ro = new ResizeObserver(fitCard);
  ro.observe(wrap);

  // Initial call
  fitCard();
})();
</script>
</body>
</html>
